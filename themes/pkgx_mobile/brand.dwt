<!DOCTYPE html>
<html lang="vi-VN">
<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="{$option.static_path}/js/html5shiv.js"></script>
  <script src="{$option.static_path}/js/respond.min.js"></script>
<![endif]-->
<head>
{if $description}<meta name="description" content="{$description}"/>{/if}
{if $keywords}<meta name="keywords" content="{$keywords}"/>{/if}
<meta content="INDEX,FOLLOW" name="robots" />
<title>Nhà Phân Phối Phụ Kiện {$brand.brand_name} Chính Thức Tại VN</title>
<link rel="canonical" href="{$base_path}/thuong-hieu/{$brand.site_url}.html" />
<link rel="alternate" href="{$base_path}/thuong-hieu/{$brand.site_url}.html" hreflang="vi-vn" />
<meta itemprop="image" content="{$brand.brand_logo}" />
<meta property="og:image" content="{$brand.brand_logo}" />
<meta property="og:url" itemprop="url" content="{$base_path}/thuong-hieu/{$brand.site_url}.html" />
<meta property="og:image:secure_url" itemprop="thumbnailUrl" content="{$brand.brand_logo}" />
{include file='library/html_header.lbi'}

    {* --- Bắt đầu Schema ItemList cho trang danh mục --- *}
    <script type="application/ld+json">
    {
      "@type": "ItemList",
      "name": "{$page_title}",
      "description": "{$description|escape:'json'}",
      "numberOfItems": "{$total}",
      "itemListElement": [
        {* Vòng lặp `foreach` cho từng sản phẩm *}
        {foreach from=$goods_list item=goods name=goods_list}
        {
          "@type": "ListItem",
          "position": {$smarty.foreach.goods_list.iteration},
          "item": {
            "@type": "Product",
            "name": "{$goods.goods_name|escape:'json'}",
            "url": "{$base_path}/{$goods.url}",
            "image": "{$cdn_path}/{$goods.goods_thumb}",
            "brand": {
                "@type": "Brand",
                "name": "{$brand.brand_name}"
            },
            "sku": "{$goods.goods_sn}",
            "offers": {
              "@type": "Offer",
              "priceCurrency": "VND",
              "price": "{$goods.shop_price_raw}",
              "itemCondition": "https://schema.org/NewCondition",
              "availability": "https://schema.org/InStock"
            },
            "description": "{$goods.goods_brief|escape:'json'}"
          }
        }
        {if !$smarty.foreach.goods_list.last},{/if}
        {/foreach}
      ]
    }

    </script>

<link type="text/css" href="{$option.static_path}/css/global.css" rel="stylesheet"/>
{insert_css files="css/brand_list.css"}
</head>
<body id="page_{$pname}">
{include file='library/page_header.lbi'}
<section>
    {include file='library/ur_here.lbi'}
    {include file='library/cat_filter_brand.lbi'}
    <div class="col_sub">
    {$render.before_col_sub}
    {$render.after_col_sub}
    </div>
    {$render.before_col_main}
    <!-- #BeginLibraryItem "/library/brand_goods_list.lbi" --><!-- #EndLibraryItem -->
    {$render.after_col_main}
        <div class="clr"></div>
        {* ----- PHẦN HIỂN THỊ TIN TỨC LIÊN QUAN ĐẾN THƯƠNG HIỆU ----- *}
    {if $brand_articles}
        <div class="brand-articles-wrapper  " >
        <h2>Tin tức &amp; Đánh giá về {$brand.brand_name|escape:html}</h2>
            <ul class="news">
                {foreach from=$brand_articles item=article}
                <li> 
                    <a href="{$article.url}" title="{$article.title|escape:html}">
                    {if $article.image}
                    <img width="110" height="70" src="{$cdn_path}/{$article.image}" alt="{$article.title|escape:html}" />
                    {/if}
                    <h3>{$article.title|escape:html}</h3>
                    <span>{$article.summary|escape:html}</span>
                    <span class="date">{$article.add_time_formatted}</span>
                    </a>
                </li>  
                {/foreach}
            </ul>
        </div>
        </div>
    {/if}

    {if $brand.brand_long_desc}
    <article style="margin-bottom: 10px">
          <div class="article_content">
        {$brand.brand_long_desc}
      </div>
    </article>{/if}
    </section>
{include file='library/page_footer.lbi'}
{insert_js name='default.Desktop.min.js' no_minify='js/jquery.min.1.8.3.js,js/plugins.js,js/lang.vi_vn.js' minify='js/global.js,js/init.js'}
{include file='library/html_footer_menu.lbi'}
{include file='library/html_footer.lbi'}
<script type="text/javascript">
$(document).ready(function() {
    
    // Bắt sự kiện click trên container chứa nút "Xem thêm"
    // Dùng event delegation để nó hoạt động cả sau khi nút được tải lại
    $(document).on('click', '#load_more_container a', function(e) {
        // Ngăn link tự chuyển trang
        e.preventDefault();

        var buttonLink = $(this);
        var container = $('#load_more_container');
        
        // Tìm link của trang tiếp theo từ khu vực phân trang BỊ ẨN
        var nextPageLink = $('#hidden_pager').find('a.next, a:contains("Tiếp theo"), a:contains("Trang tiếp")');

        if (nextPageLink.length === 0) {
            container.hide(); // Nếu không còn trang tiếp, ẩn nút đi
            return;
        }

        var url = nextPageLink.attr('href');
        
        // Hiển thị trạng thái loading
        container.html('<p>Đang tải...</p>');

        // Thêm tham số is_ajax=1 vào URL
        var ajaxUrl = url + (url.indexOf('?') > -1 ? '&' : '?') + 'is_ajax=1';

        $.ajax({
            url: ajaxUrl,
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                // Nối thêm sản phẩm mới vào danh sách
                if (response && response.goods_list) {
                    $('#brand_goods_list').append(response.goods_list);
                }
                
                // Cập nhật lại phân trang số bị ẩn
                if (response && response.hidden_pager) {
                    $('#hidden_pager').html(response.hidden_pager);
                }
                
                // Cập nhật lại nút "Xem thêm"
                if (response && response.load_more_button) {
                    container.html(response.load_more_button);
                } else {
                    container.hide();
                }
            },
            error: function() {
                // Nếu có lỗi, chỉ đơn giản là chuyển hướng đến trang tiếp theo
                window.location.href = url;
            }
        });
    });
});
</script>
</body>
</html>
